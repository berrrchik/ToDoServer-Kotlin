# TodoServer - Серверная часть для приложения управления задачами

## Описание проекта
TodoServer - это REST API сервер для мобильного приложения управления задачами, разработанный на языке Kotlin с использованием фреймворка Ktor. Сервер обеспечивает полную функциональность для управления списками задач, категориями и учетными записями пользователей.

## Технологии
- **Язык программирования**: Kotlin 1.9
- **Фреймворк**: Ktor 2.3
- **База данных**: PostgreSQL
- **ORM**: Exposed (библиотека для работы с SQL в Kotlin)
- **Сериализация**: kotlinx.serialization
- **Документация API**: OpenAPI/Swagger

## Основные возможности
- **Аутентификация пользователей**:
  - Регистрация новых пользователей
  - Вход в систему с использованием логина и пароля
  - Токены для аутентификации запросов
- **Управление задачами**:
  - Создание новых задач
  - Просмотр списка задач
  - Обновление задач (название, описание, статус, приоритет)
  - Пометка задач как выполненных
  - Удаление задач (мягкое и полное удаление)
- **Управление категориями**:
  - Создание пользовательских категорий
  - Стандартные категории (Дом, Работа, Учёба, Другое)
  - Возможность скрытия категорий
  - Просмотр и управление скрытыми категориями

## Структура проекта
Проект организован по принципу модульности и разделения ответственности:
- `ru.todoapp` - основной пакет приложения
  - `Application.kt` - входная точка приложения и конфигурация
  - `register` - регистрация пользователей
  - `login` - аутентификация
  - `tasks` - управление задачами
  - `categories` - управление категориями
  - `database` - работа с базой данных
    - `users` - таблица пользователей
    - `tokens` - таблица токенов
    - `tasks` - таблица задач
    - `categories` - таблица категорий
    - `hidden_categories` - таблица скрытых категорий
  - `utils` - вспомогательные функции

## API Endpoints

### Аутентификация
- `POST /register` - регистрация нового пользователя
- `POST /login` - вход в систему

### Задачи
- `GET /tasks` - получение всех задач пользователя
- `POST /tasks` - создание новой задачи
- `GET /tasks/{id}` - получение задачи по ID
- `PUT /tasks` - обновление задачи
- `DELETE /tasks/{id}` - мягкое удаление задачи
- `DELETE /tasks/permanently/{id}` - полное удаление задачи

### Категории
- `GET /categories` - получение всех категорий пользователя
- `POST /categories` - создание новой категории
- `GET /categories/{id}` - получение категории по ID
- `PUT /categories` - обновление категории
- `DELETE /categories/{id}` - удаление категории
- `POST /categories/hide` - скрытие категории
- `POST /categories/unhide/{id}` - отображение скрытой категории
- `GET /categories/hidden` - получение списка скрытых категорий

## Установка и запуск

### Требования
- JDK 11 или выше
- Gradle 7.0 или выше
- PostgreSQL 12 или выше

### Настройка базы данных
1. Создайте базу данных PostgreSQL:
```sql
CREATE DATABASE todoapp;
```

2. Создайте конфигурационный файл `src/main/resources/application.conf`:
```
# Скопируйте содержимое файла application.conf.example
# и замените учетные данные на свои
```

Пример файла конфигурации `application.conf`:
```hocon
ktor {
    deployment {
        port = 8080
        host = "0.0.0.0"
    }
    application {
        modules = [ ru.todoapp.ApplicationKt.module ]
    }
}

database {
    url = "jdbc:postgresql://localhost:5432/todoapp"
    driver = "org.postgresql.Driver"
    user = "your_db_user"
    password = "your_db_password"
}
```

### Запуск проекта
1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/TodoServer.git
cd TodoServer
```

2. Создайте конфигурационный файл (см. инструкции выше).

3. Соберите проект:
```bash
./gradlew build
```

4. Запустите сервер:
```bash
./gradlew run
```

После успешного запуска сервер будет доступен по адресу `http://0.0.0.0:8080`.

## Документация API
Документация API доступна через Swagger UI по адресу `http://0.0.0.0:8080/swagger`.
OpenAPI спецификация доступна по адресу `http://0.0.0.0:8080/openapi.yaml`.

## Примеры запросов

### Регистрация пользователя
```http
POST /register
Content-Type: application/json

{
  "login": "user1",
  "email": "user1@example.com",
  "password": "password123"
}
```

### Вход в систему
```http
POST /login
Content-Type: application/json

{
  "login": "user1",
  "password": "password123"
}
```

### Создание задачи
```http
POST /tasks
Content-Type: application/json
Authorization: Bearer {your_token}

{
  "title": "Выполнить домашнее задание",
  "description": "Сделать математику и физику",
  "priority": "ВЫСОКИЙ",
  "categoryId": "category_id_here",
  "deadline": "2023-12-31T23:59:59"
}
```

## Лицензия
Этот проект распространяется под лицензией MIT.

## Контакты
При возникновении вопросов или предложений, пожалуйста, создайте issue в репозитории проекта.

